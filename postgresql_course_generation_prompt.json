{
  "course_metadata": {
    "course_title": "PostgreSQL Uncovered: Internals, Trace Analysis, and Performance",
    "course_description": "A comprehensive technical deep-dive into PostgreSQL internals, from SQL execution to storage, MVCC, transactions, and query optimization",
    "target_audience": "Backend engineers, database administrators, performance engineers, and developers who want deep understanding of PostgreSQL internals",
    "prerequisites": [
      "Basic SQL knowledge",
      "Understanding of database concepts (tables, indexes, queries)",
      "Familiarity with C programming (helpful but not required)",
      "Basic operating systems knowledge (processes, memory, disk I/O)"
    ],
    "learning_outcomes": [
      "Understand PostgreSQL's complete architecture from query parsing to execution",
      "Explain how PostgreSQL manages memory, buffers, and disk storage",
      "Master MVCC, transactions, and isolation mechanisms",
      "Analyze query plans and optimize performance based on internals",
      "Debug PostgreSQL performance issues using internals knowledge",
      "Contribute to PostgreSQL or build extensions"
    ]
  },
  
  "content_generation_instructions": {
    "role": "Expert PostgreSQL core developer and database systems educator with 10+ years experience",
    
    "primary_references": {
      "source_code": "https://github.com/postgres/postgres/tree/master",
      "key_directories": [
        "src/backend/executor/ - Query execution engine",
        "src/backend/optimizer/ - Query planner and optimizer",
        "src/backend/storage/ - Storage manager, buffer manager, smgr",
        "src/backend/access/ - Access methods (heap, index, transam)",
        "src/backend/commands/ - SQL commands implementation",
        "src/backend/utils/ - Utilities, cache, memory contexts",
        "src/include/ - All header files with data structures",
        "doc/src/sgml/ - Official documentation source"
      ],
      "documentation": [
        "https://www.postgresql.org/docs/current/internals.html",
        "https://wiki.postgresql.org/wiki/Development_information",
        "PostgreSQL source code comments (extensive inline documentation)",
        "README files in each source directory"
      ],
      "key_papers": [
        "The Design of POSTGRES (Stonebraker, 1986)",
        "MVCC implementation papers",
        "Query optimization research papers referenced in code"
      ]
    },
    
    "content_structure_per_lesson": {
      "filename_format": "module_{MODULE_NUM}_lesson_{LESSON_NUM}_{kebab-case-title}.md",
      
      "required_sections": [
        {
          "section": "Front Matter",
          "elements": [
            "Lesson number and title",
            "Estimated reading time",
            "Prerequisites (previous lessons required)",
            "Learning objectives (3-5 specific outcomes)",
            "Key terms and concepts introduced"
          ]
        },
        {
          "section": "Introduction",
          "requirements": [
            "Real-world motivation: Why does this matter?",
            "Brief overview of what you'll learn",
            "Connection to previous lessons",
            "Preview of key insights"
          ],
          "length": "300-500 words"
        },
        {
          "section": "Conceptual Foundation",
          "requirements": [
            "Explain the problem being solved",
            "High-level design decisions and tradeoffs",
            "Architectural overview with diagrams (describe in detail)",
            "Key data structures (conceptual level first)"
          ],
          "length": "800-1200 words",
          "diagrams": "Include 2-3 conceptual diagrams (described in markdown)"
        },
        {
          "section": "Deep Dive: Implementation Details",
          "requirements": [
            "Reference specific source files and functions",
            "Explain key data structures with actual C struct definitions",
            "Walk through critical code paths step-by-step",
            "Show actual code snippets with detailed explanations",
            "Explain algorithm implementations",
            "Memory layout and size considerations"
          ],
          "length": "2000-3000 words",
          "code_snippets": "5-10 code examples from PostgreSQL source",
          "structure": [
            "Start with data structures",
            "Then explain algorithms",
            "Then show how they work together",
            "Include edge cases and error handling"
          ]
        },
        {
          "section": "Practical Examples and Tracing",
          "requirements": [
            "Concrete SQL examples demonstrating the concept",
            "How to observe this behavior (pg_stat views, logs, debugging)",
            "EXPLAIN output analysis where relevant",
            "strace/perf examples for system-level observation",
            "Common scenarios and their internal behavior"
          ],
          "length": "1000-1500 words",
          "examples": "3-5 practical demonstrations"
        },
        {
          "section": "Performance Implications",
          "requirements": [
            "How this design affects performance",
            "When it's fast vs slow and why",
            "Configuration parameters related to this topic",
            "Common performance pitfalls",
            "Optimization strategies based on internals"
          ],
          "length": "800-1200 words"
        },
        {
          "section": "Advanced Topics and Edge Cases",
          "requirements": [
            "Corner cases and special scenarios",
            "Interaction with other subsystems",
            "Version differences (if significant)",
            "Advanced configuration and tuning",
            "Related extension points or customization"
          ],
          "length": "600-1000 words"
        },
        {
          "section": "Hands-On Exercises",
          "requirements": [
            "3-5 exercises progressing from basic to advanced",
            "Include: SQL queries, code reading, tracing, analysis",
            "Provide expected outcomes",
            "Challenge problems for advanced learners"
          ]
        },
        {
          "section": "Key Takeaways",
          "requirements": [
            "5-7 bullet points summarizing essential knowledge",
            "Mental models to remember",
            "When to apply this knowledge in practice"
          ]
        },
        {
          "section": "Further Reading",
          "requirements": [
            "Specific source files to explore",
            "Related PostgreSQL documentation pages",
            "Academic papers if relevant",
            "Blog posts or talks by core developers",
            "Next lessons that build on this content"
          ]
        },
        {
          "section": "References",
          "requirements": [
            "All source files mentioned",
            "All functions referenced",
            "All data structures covered",
            "External resources cited"
          ]
        }
      ]
    },
    
    "content_quality_requirements": {
      "technical_depth": [
        "MUST reference actual PostgreSQL source code files and line numbers (approximate if version varies)",
        "MUST include actual C struct definitions, not pseudocode",
        "MUST explain WHY design decisions were made, not just WHAT they are",
        "MUST cover both the happy path and error/edge cases",
        "MUST show real code from postgres/postgres repository",
        "MUST explain memory management and resource lifecycle",
        "MUST discuss concurrency implications where relevant"
      ],
      
      "pedagogical_approach": [
        "Start simple, build complexity gradually",
        "Use analogies and mental models before diving into code",
        "Explain the problem before the solution",
        "Show the evolution: why not simpler approaches?",
        "Connect to reader's existing knowledge",
        "Provide multiple perspectives (user, DBA, developer)",
        "Include 'common misconceptions' sections where helpful"
      ],
      
      "code_examples": [
        "Always provide context: which file, what version",
        "Format code snippets properly with syntax highlighting",
        "Add inline comments explaining complex parts",
        "Show both the data structures AND the functions that use them",
        "Include before/after examples where relevant",
        "Link to actual GitHub permalinks when possible"
      ],
      
      "diagrams_and_visualization": [
        "Describe ASCII diagrams for data structures",
        "Create flow diagrams for processes",
        "Show memory layouts visually",
        "Illustrate relationships between components",
        "Use sequence diagrams for multi-step operations",
        "Show state transitions where relevant"
      ],
      
      "writing_style": [
        "Clear, technical, precise",
        "Active voice preferred",
        "Define all acronyms on first use",
        "Use consistent terminology matching PostgreSQL codebase",
        "Balance accessibility with technical accuracy",
        "No marketing language, pure technical education",
        "Conversational but authoritative tone"
      ]
    },
    
    "specific_content_guidelines": {
      "for_storage_topics": [
        "Show exact on-disk format",
        "Explain page headers, item pointers, tuples",
        "Cover alignment and padding",
        "Discuss file organization and naming",
        "Show actual hex dumps where illuminating"
      ],
      
      "for_memory_topics": [
        "Explain memory contexts and their hierarchy",
        "Show allocation strategies",
        "Cover memory lifetime and cleanup",
        "Discuss cache management algorithms",
        "Include memory debugging techniques"
      ],
      
      "for_concurrency_topics": [
        "Show lock structures and protocols",
        "Explain deadlock detection",
        "Cover race conditions and how they're prevented",
        "Discuss lock contention scenarios",
        "Show wait queues and conflict resolution"
      ],
      
      "for_optimizer_topics": [
        "Show actual cost formulas",
        "Explain statistics usage",
        "Walk through join ordering decisions",
        "Show plan tree structures",
        "Include EXPLAIN ANALYZE interpretation"
      ],
      
      "for_transaction_topics": [
        "Show transaction ID assignment",
        "Explain visibility checks in detail",
        "Cover snapshot isolation mechanics",
        "Show commit/abort protocols",
        "Discuss two-phase commit internals"
      ]
    },
    
    "research_methodology": {
      "code_exploration_steps": [
        "1. Read the README in the relevant src/ directory",
        "2. Identify key header files and data structures",
        "3. Find the main entry points (functions called by executor/planner)",
        "4. Trace code paths for common operations",
        "5. Read inline comments (PostgreSQL has excellent documentation)",
        "6. Check git history for design decisions",
        "7. Search mailing list archives for discussions",
        "8. Review regression tests for edge cases"
      ],
      
      "documentation_sources_priority": [
        "1. Inline code comments in PostgreSQL source",
        "2. README files in source directories",
        "3. Official PostgreSQL documentation (doc/src/sgml/)",
        "4. PostgreSQL wiki developer pages",
        "5. Academic papers cited in code comments",
        "6. Presentations by core developers",
        "7. postgresql-hackers mailing list archives"
      ]
    },
    
    "validation_checklist": {
      "before_finalizing_each_lesson": [
        "✓ All code references are accurate and from actual source",
        "✓ All technical claims are verifiable in code or docs",
        "✓ Examples can be tested on a real PostgreSQL instance",
        "✓ Explanations match actual implementation (not idealized version)",
        "✓ Version differences noted if significant",
        "✓ No placeholder or TODO content remains",
        "✓ All diagrams clearly described",
        "✓ Exercises have clear objectives and expected outcomes",
        "✓ Cross-references to other lessons are accurate",
        "✓ Technical depth matches course level (internals-focused)"
      ]
    }
  },
  
  "lesson_generation_template": {
    "input_for_each_lesson": {
      "module_number": "INTEGER",
      "lesson_number": "INTEGER",
      "lesson_title": "STRING",
      "brief_description": "2-3 sentences about what this lesson covers",
      "key_source_files": ["List of relevant PostgreSQL source files"],
      "prerequisites": ["Previous lessons that must be understood first"],
      "estimated_length": "Target word count based on complexity"
    },
    
    "generation_process": {
      "step_1": "Research phase - Read all relevant source code and documentation",
      "step_2": "Structure phase - Create detailed outline following required_sections",
      "step_3": "Content phase - Write each section with code examples and explanations",
      "step_4": "Code extraction - Pull actual code snippets from PostgreSQL source",
      "step_5": "Diagram phase - Create ASCII diagrams and flowcharts",
      "step_6": "Example phase - Create practical SQL and tracing examples",
      "step_7": "Exercise phase - Design hands-on activities",
      "step_8": "Review phase - Validate against checklist",
      "step_9": "Polish phase - Refine writing, add cross-references",
      "step_10": "Final check - Ensure all learning objectives are met"
    },
    
    "output_format": {
      "file_type": "Markdown (.md)",
      "total_length": "6000-10000 words per lesson (varies by complexity)",
      "code_to_prose_ratio": "30-40% code/diagrams, 60-70% explanation",
      "formatting": [
        "Use proper markdown headers (##, ###, ####)",
        "Code blocks with language tags (```c, ```sql, ```bash)",
        "Tables for comparing options or showing data",
        "Blockquotes for important notes or warnings",
        "Inline code for function names, variables, filenames",
        "Links to source code on GitHub when possible"
      ]
    }
  },
  
  "example_lesson_generation_prompt": {
    "description": "Example of how to generate a specific lesson",
    "sample_input": {
      "module_number": 2,
      "lesson_number": 9,
      "lesson_title": "B+ Tree Indexes: Structure, Search, and Maintenance",
      "key_source_files": [
        "src/backend/access/nbtree/nbtree.c",
        "src/backend/access/nbtree/nbtsearch.c",
        "src/backend/access/nbtree/nbtinsert.c",
        "src/backend/access/nbtree/nbtpage.c",
        "src/include/access/nbtree.h",
        "src/backend/access/nbtree/README"
      ],
      "prerequisites": [
        "Module 2, Lesson 6: Heap Storage",
        "Module 2, Lesson 7: Pages and Tuples"
      ]
    },
    
    "sample_generation_instruction": "Generate a comprehensive lesson on PostgreSQL's B+ tree implementation. Start by reading src/backend/access/nbtree/README which contains excellent design documentation. Explain the BTPageOpaqueData structure, how pages are linked, the search algorithm in _bt_search(), insertion with _bt_doinsert(), and page splits. Show actual code for traversing the tree. Include EXPLAIN output showing index usage. Demonstrate how to observe index growth and fragmentation. Cover unique vs non-unique indexes, index-only scans, and the fastpath optimization. Provide exercises on creating indexes and analyzing their structure using pageinspect extension."
  },
  
  "course_completion_criteria": {
    "all_38_lessons_generated": "Each lesson follows the template and meets quality requirements",
    "comprehensive_coverage": "All major PostgreSQL subsystems covered in depth",
    "code_referenced": "Every lesson references actual PostgreSQL source code",
    "practical_examples": "Every lesson includes testable SQL and tracing examples",
    "progressive_learning": "Lessons build on each other logically",
    "production_ready": "Content is accurate, complete, and professionally written"
  },
  
  "additional_course_materials": {
    "supplementary_content": [
      "Course introduction with setup instructions",
      "PostgreSQL compilation and debugging guide",
      "Source code navigation guide",
      "Useful extensions for learning (pg_stat_statements, pageinspect, etc.)",
      "Performance testing and benchmarking toolkit",
      "Glossary of PostgreSQL-specific terms",
      "Index of all source files referenced across lessons",
      "Quick reference sheets for key data structures"
    ],
    
    "hands_on_labs": [
      "Setting up PostgreSQL from source with debugging symbols",
      "Using gdb to step through query execution",
      "Analyzing buffer cache behavior",
      "Tracing transaction processing",
      "Observing MVCC and vacuum in action",
      "Query plan analysis workshop",
      "Building a simple table access method extension"
    ]
  },
  
  "per_lesson_prompt_template": "You are an expert PostgreSQL core developer and educator. Generate a comprehensive, in-depth lesson titled '{LESSON_TITLE}' (Module {MODULE_NUM}, Lesson {LESSON_NUM}).\n\nRESEARCH REQUIREMENTS:\n- Read and reference these source files: {SOURCE_FILES}\n- Study the PostgreSQL codebase at https://github.com/postgres/postgres\n- Reference official documentation and developer wiki\n- Include actual code snippets from the source\n\nCONTENT REQUIREMENTS:\nFollow this exact structure:\n1. Front Matter (title, time, prerequisites, objectives, key terms)\n2. Introduction (300-500 words, motivation and overview)\n3. Conceptual Foundation (800-1200 words, high-level design)\n4. Deep Dive: Implementation Details (2000-3000 words, code walkthrough)\n5. Practical Examples and Tracing (1000-1500 words, SQL and observation)\n6. Performance Implications (800-1200 words, tuning and optimization)\n7. Advanced Topics and Edge Cases (600-1000 words)\n8. Hands-On Exercises (3-5 exercises)\n9. Key Takeaways (5-7 bullets)\n10. Further Reading (with specific source files and docs)\n11. References (all sources cited)\n\nQUALITY STANDARDS:\n- Reference actual PostgreSQL C code with file paths and function names\n- Show real data structures (struct definitions)\n- Explain WHY design decisions were made\n- Include ASCII diagrams for visualization\n- Provide testable SQL examples\n- Cover both common cases and edge cases\n- Write 6000-10000 words of technical, educational content\n- Use clear, precise technical writing\n- No marketing language, pure technical education\n\nTarget this lesson at backend engineers who want deep PostgreSQL internals knowledge. Make it comprehensive enough to serve as both learning material and future reference.",
  
  "batch_generation_workflow": {
    "description": "How to generate all 38 lessons efficiently",
    "steps": [
      "1. Generate Module 1 (Foundation) first - 5 lessons on query processing pipeline",
      "2. Generate Module 2 (Storage) - 6 lessons on heap, pages, TOAST, indexes",
      "3. Generate Module 3 (Memory) - 5 lessons on buffers and memory management",
      "4. Generate Module 4 (WAL) - 5 lessons on write-ahead logging and recovery",
      "5. Generate Module 5 (MVCC) - 6 lessons on multi-version concurrency",
      "6. Generate Module 6 (Transactions) - 5 lessons on isolation and locking",
      "7. Generate Module 7 (Vacuum) - 5 lessons on cleanup and maintenance",
      "8. Generate Module 8 (System Catalogs) - 3 lessons on metadata",
      "9. Generate Module 9 (Query Planner) - 7 lessons on optimization",
      "10. Generate Module 10 (Joins/Aggregation) - 4 lessons on advanced execution",
      "11. Generate Module 11 (Performance) - 5 lessons on analysis and tracing",
      "12. Generate Module 12 (Extensions) - 3 lessons on customization"
    ],
    "validation_between_modules": "After each module, verify cross-references and ensure progressive complexity"
  },
  
  "notes": [
    "This prompt is designed to generate production-quality technical course content",
    "Each lesson should be comprehensive enough to stand alone as reference material",
    "The course should be practical - every concept should be observable/testable",
    "Code accuracy is critical - always verify against actual PostgreSQL source",
    "Focus on building mental models, not just listing facts",
    "The 'why' is as important as the 'what' and 'how'",
    "This is an internals course - go deep, don't stay surface level"
  ]
}
